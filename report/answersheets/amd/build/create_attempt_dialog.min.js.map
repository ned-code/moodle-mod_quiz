{"version":3,"sources":["../src/create_attempt_dialog.js"],"names":["define","$","ModalFactory","ModalEvents","Ajax","Notification","t","SELECTOR","init","click","e","preventDefault","target","closest","find","disableButton","message","data","modalButton","M","util","get_string","params","quizid","userid","url","create","type","types","SAVE_CANCEL","title","body","done","modal","setSaveButtonText","getRoot","on","save","createAttempt","show","hidden","closeModal","catch","err","exceptionHandler","destroy","modalButtons","promises","call","methodname","args","then","res","id","window","location","href","updateQueryStringParameter","fail","el","status","prop","ex","exception","uri","key","value","re","RegExp","separator","indexOf","match","replace"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the create_attempt_dialog class.\n *\n * @module    quiz_answersheets/create_attempt_dialog\n * @package   quiz_answersheets\n * @copyright  2019 The Open University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/modal_factory', 'core/modal_events', 'core/ajax', 'core/notification'],\n    function($, ModalFactory, ModalEvents, Ajax, Notification) {\n        var t = {\n            SELECTOR: '.create-attempt-btn',\n            init: function() {\n                $(t.SELECTOR).click(function(e) {\n                    e.preventDefault();\n                    var target = $(this).closest('table').find('button');\n                    t.disableButton(target, true);\n                    var message = $(this).data('message');\n                    var modalButton = M.util.get_string('create_attempt_modal_button', 'quiz_answersheets');\n                    var params = {\n                        quizid: $(this).data('quiz-id'),\n                        userid: $(this).data('user-id'),\n                        url: $(this).data('url')\n                    };\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: M.util.get_string('create_attempt_modal_title', 'quiz_answersheets'),\n                        body: message\n                    }).done(function(modal) {\n                        modal.setSaveButtonText(modalButton);\n                        modal.getRoot().on(ModalEvents.save, params, t.createAttempt);\n                        modal.show();\n                        // Handle hidden event.\n                        modal.getRoot().on(ModalEvents.hidden, modal, t.closeModal);\n                        return modal;\n                    }).catch(function(err) {\n                        t.exceptionHandler(err, target);\n                    });\n                });\n            },\n            closeModal: function(e) {\n                var modal = e.data;\n                var target = $(t.SELECTOR).closest('table').find('button');\n                modal.destroy();\n                t.disableButton(target, false);\n            },\n            createAttempt: function(e) {\n                e.preventDefault();\n                var data = e.data;\n                var modalButtons = $(e.target).find('button');\n                t.disableButton(modalButtons, true);\n                var promises = Ajax.call([{\n                    methodname: 'quiz_answersheets_create_attempt',\n                    args: {\n                        quizid: data.quizid,\n                        userid: data.userid\n                    }\n                }]);\n                // Handle promise.\n                promises[0].then(function(res) {\n                    var id = res.id || '';\n                    window.location.href = t.updateQueryStringParameter(data.url, 'lastchanged', id);\n                    return true;\n                }).fail(function(err) {\n                    t.exceptionHandler(err, modalButtons);\n                });\n            },\n            disableButton: function(el, status) {\n                el.prop(\"disabled\", status);\n            },\n            exceptionHandler: function(ex, el) {\n                Notification.exception(ex);\n                t.disableButton(el, false);\n            },\n            updateQueryStringParameter: function(uri, key, value) {\n                var re = new RegExp(\"([?&])\" + key + \"=.*?(&|$)\", \"i\");\n                var separator = uri.indexOf('?') !== -1 ? \"&\" : \"?\";\n                if (uri.match(re)) {\n                    return uri.replace(re, '$1' + key + \"=\" + value + '$2');\n                } else {\n                    return uri + separator + key + \"=\" + value;\n                }\n            }\n        };\n        return t;\n    });\n"],"file":"create_attempt_dialog.min.js"}