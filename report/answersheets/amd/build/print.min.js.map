{"version":3,"sources":["../src/print.js"],"names":["define","$","Ajax","Notification","t","mconfig","SELECTOR","PAGE_HEADER","PAGE_CONTAINER","QTYPE_ORDERING_VERTICAL_SORTABLE_LIST","QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST","QTYPE_ORDERING_MARGIN","TEMPLATE","QTYPE_ORDERING_WRAPPER","pageHeaderHeight","pageContainer","pageHeader","init","options","height","css","Math","abs","window","addEventListener","handlePrintStart","handlePrintStop","e","preventDefault","Y","UA","gecko","handlePrintForOrdering","promises","call","methodname","args","attemptid","userid","courseid","cmid","quizid","pagetype","then","fail","err","exception","isPrinting","sortablesVertical","sortablesHorizontal","length","each","i","nodeSortableVertical","marginEle","before","after","nodeSortableHorizontal","addClass","wrap","remove","unwrap"],"mappings":"AAuBAA,OAAM,2BAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,mBAAxB,CAAD,CAA+C,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAgC,CAEjF,GAAIC,CAAAA,CAAC,CAAG,CAKJC,OAAO,CAAE,IALL,CAUJC,QAAQ,CAAE,CACNC,WAAW,CAAE,6BADP,CAENC,cAAc,CAAE,OAFV,CAGNC,qCAAqC,CAAE,2CAHjC,CAINC,uCAAuC,CAAE,6CAJnC,CAKNC,qBAAqB,CAAE,iBALjB,CAVN,CAqBJC,QAAQ,CAAE,CACND,qBAAqB,CAAE,sCADjB,CAENE,sBAAsB,CAAE,uCAFlB,CArBN,CA6BJC,gBAAgB,CAAE,CA7Bd,CAkCJC,aAAa,CAAE,IAlCX,CAuCJC,UAAU,CAAE,IAvCR,CA8CJC,IAAI,CAAE,cAASC,CAAT,CAAkB,CACpBd,CAAC,CAACC,OAAF,CAAYa,CAAZ,CACAd,CAAC,CAACY,UAAF,CAAef,CAAC,CAACG,CAAC,CAACE,QAAF,CAAWC,WAAZ,CAAhB,CACAH,CAAC,CAACW,aAAF,CAAkBd,CAAC,CAACG,CAAC,CAACE,QAAF,CAAWE,cAAZ,CAAnB,CACAJ,CAAC,CAACU,gBAAF,CAAqBV,CAAC,CAACY,UAAF,CAAaG,MAAb,EAArB,CAGAf,CAAC,CAACY,UAAF,CAAaI,GAAb,CAAiB,KAAjB,CAAwB,CAACC,IAAI,CAACC,GAAL,CAASlB,CAAC,CAACU,gBAAX,CAAzB,EAEAV,CAAC,CAACW,aAAF,CAAgBK,GAAhB,CAAoB,YAApB,CAAkChB,CAAC,CAACU,gBAApC,EAEAS,MAAM,CAACC,gBAAP,CAAwB,aAAxB,CAAuCpB,CAAC,CAACqB,gBAAzC,EACAF,MAAM,CAACC,gBAAP,CAAwB,YAAxB,CAAsCpB,CAAC,CAACsB,eAAxC,CACH,CA3DG,CAkEJD,gBAAgB,CAAE,0BAASE,CAAT,CAAY,CAC1BA,CAAC,CAACC,cAAF,GACAxB,CAAC,CAACW,aAAF,CAAgBK,GAAhB,CAAoB,YAApB,CAAkC,CAAlC,EACA,GAAIS,CAAC,CAACC,EAAF,CAAKC,KAAT,CAAgB,CACZ3B,CAAC,CAACW,aAAF,CAAgBK,GAAhB,CAAoB,aAApB,CAAmChB,CAAC,CAACU,gBAAF,CAAqB,EAAxD,EACAV,CAAC,CAACY,UAAF,CAAaI,GAAb,CAAiB,KAAjB,CAAwB,CAAxB,CACH,CAEDhB,CAAC,CAAC4B,sBAAF,KAEA,GAAIC,CAAAA,CAAQ,CAAG/B,CAAI,CAACgC,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAE,gCADU,CAEtBC,IAAI,CAAE,CACFC,SAAS,CAAEjC,CAAC,CAACC,OAAF,CAAUgC,SADnB,CAEFC,MAAM,CAAElC,CAAC,CAACC,OAAF,CAAUiC,MAFhB,CAGFC,QAAQ,CAAEnC,CAAC,CAACC,OAAF,CAAUkC,QAHlB,CAIFC,IAAI,CAAEpC,CAAC,CAACC,OAAF,CAAUmC,IAJd,CAKFC,MAAM,CAAErC,CAAC,CAACC,OAAF,CAAUoC,MALhB,CAMFC,QAAQ,CAAEtC,CAAC,CAACC,OAAF,CAAUqC,QANlB,CAFgB,CAAD,CAAV,CAAf,CAYAT,CAAQ,CAAC,CAAD,CAAR,CAAYU,IAAZ,CAAiB,UAAW,CACxB,QACH,CAFD,EAEGC,IAFH,CAEQ,SAASC,CAAT,CAAc,CAClB1C,CAAY,CAAC2C,SAAb,CAAuBD,CAAvB,CACH,CAJD,CAKH,CA7FG,CAqGJnB,eAAe,CAAE,yBAASC,CAAT,CAAY,CACzBA,CAAC,CAACC,cAAF,GACAxB,CAAC,CAACW,aAAF,CAAgBK,GAAhB,CAAoB,YAApB,CAAkChB,CAAC,CAACU,gBAApC,EACA,GAAIe,CAAC,CAACC,EAAF,CAAKC,KAAT,CAAgB,CACZ3B,CAAC,CAACW,aAAF,CAAgBK,GAAhB,CAAoB,aAApB,CAAmC,CAAnC,EACAhB,CAAC,CAACY,UAAF,CAAaI,GAAb,CAAiB,KAAjB,CAAwB,CAACC,IAAI,CAACC,GAAL,CAASlB,CAAC,CAACU,gBAAX,CAAzB,CACH,CACDV,CAAC,CAAC4B,sBAAF,KACA,QACH,CA9GG,CAqHJA,sBAAsB,CAAE,gCAASe,CAAT,CAAqB,IACrCC,CAAAA,CAAiB,CAAG/C,CAAC,CAACG,CAAC,CAACE,QAAF,CAAWG,qCAAZ,CADgB,CAErCwC,CAAmB,CAAGhD,CAAC,CAACG,CAAC,CAACE,QAAF,CAAWI,uCAAZ,CAFc,CAGzC,GAAIsC,CAAiB,CAACE,MAAlB,EAA4BD,CAAmB,CAACC,MAApD,CAA4D,CACxD,GAAIH,CAAJ,CAAgB,CACZC,CAAiB,CAACG,IAAlB,CAAuB,SAASC,CAAT,CAAYC,CAAZ,CAAkC,CAGrD,GAAIC,CAAAA,CAAS,CAAGrD,CAAC,CAACG,CAAC,CAACQ,QAAF,CAAWD,qBAAZ,CAAjB,CACAV,CAAC,CAACoD,CAAD,CAAD,CAAwBE,MAAxB,CAA+BD,CAA/B,EACArD,CAAC,CAACoD,CAAD,CAAD,CAAwBG,KAAxB,CAA8BF,CAA9B,CACH,CAND,EAQAL,CAAmB,CAACE,IAApB,CAAyB,SAASC,CAAT,CAAYK,CAAZ,CAAoC,CAGzD,GAAIH,CAAAA,CAAS,CAAGrD,CAAC,CAACG,CAAC,CAACQ,QAAF,CAAWD,qBAAZ,CAAjB,CACA2C,CAAS,CAACI,QAAV,CAAmB,YAAnB,EACAzD,CAAC,CAACwD,CAAD,CAAD,CAA0BD,KAA1B,CAAgCF,CAAhC,EACArD,CAAC,CAACwD,CAAD,CAAD,CAA0BE,IAA1B,CAA+BvD,CAAC,CAACQ,QAAF,CAAWC,sBAA1C,CACH,CAPD,CAQH,CAjBD,IAiBO,CAEHZ,CAAC,CAACG,CAAC,CAACE,QAAF,CAAWK,qBAAZ,CAAD,CAAoCiD,MAApC,GACA,GAAIX,CAAmB,CAACC,MAAxB,CAAgC,CAC5BD,CAAmB,CAACE,IAApB,CAAyB,SAASC,CAAT,CAAYK,CAAZ,CAAoC,CAEzDxD,CAAC,CAACwD,CAAD,CAAD,CAA0BI,MAA1B,EACH,CAHD,CAIH,CACJ,CACJ,CACJ,CArJG,CAAR,CAyJA,MAAOzD,CAAAA,CACV,CA5JK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for print event.\n *\n * @package   quiz_answersheets\n * @copyright 2019 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    var t = {\n\n        /**\n         * Server side config.\n         */\n        mconfig: null,\n\n        /**\n         * CSS Selector.\n         */\n        SELECTOR: {\n            PAGE_HEADER: '.attempt-sheet-header-gecko',\n            PAGE_CONTAINER: '#page',\n            QTYPE_ORDERING_VERTICAL_SORTABLE_LIST: '.que.ordering ul.sortablelist.vertical li',\n            QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST: '.que.ordering ul.sortablelist.horizontal li',\n            QTYPE_ORDERING_MARGIN: '.orderingmargin'\n        },\n\n        /**\n         * Template.\n         */\n        TEMPLATE: {\n            QTYPE_ORDERING_MARGIN: '<div class=\"orderingmargin\"></div>',\n            QTYPE_ORDERING_WRAPPER: '<div class=\"orderingwrapper\"></div>'\n        },\n\n        /**\n         * Page header height.\n         */\n        pageHeaderHeight: 0,\n\n        /**\n         * Page container.\n         */\n        pageContainer: null,\n\n        /**\n         * Page Header element\n         */\n        pageHeader: null,\n\n\n        /**\n         * Initialise function\n         * @param {object} options Options for ajax request\n         */\n        init: function(options) {\n            t.mconfig = options;\n            t.pageHeader = $(t.SELECTOR.PAGE_HEADER);\n            t.pageContainer = $(t.SELECTOR.PAGE_CONTAINER);\n            t.pageHeaderHeight = t.pageHeader.height();\n\n            // Set the correct position for page header.\n            t.pageHeader.css('top', -Math.abs(t.pageHeaderHeight));\n            // Set the space fof page header.\n            t.pageContainer.css('margin-top', t.pageHeaderHeight);\n\n            window.addEventListener('beforeprint', t.handlePrintStart);\n            window.addEventListener('afterprint', t.handlePrintStop);\n        },\n\n        /**\n         * Handle print start event.\n         *\n         * @param {Event} e\n         */\n        handlePrintStart: function(e) {\n            e.preventDefault();\n            t.pageContainer.css('margin-top', 0);\n            if (Y.UA.gecko) {\n                t.pageContainer.css('padding-top', t.pageHeaderHeight + 30);\n                t.pageHeader.css('top', 0);\n            }\n\n            t.handlePrintForOrdering(true);\n\n            var promises = Ajax.call([{\n                methodname: 'quiz_answersheets_create_event',\n                args: {\n                    attemptid: t.mconfig.attemptid,\n                    userid: t.mconfig.userid,\n                    courseid: t.mconfig.courseid,\n                    cmid: t.mconfig.cmid,\n                    quizid: t.mconfig.quizid,\n                    pagetype: t.mconfig.pagetype\n                }\n            }]);\n            // Handle promise.\n            promises[0].then(function() {\n                return true;\n            }).fail(function(err) {\n                Notification.exception(err);\n            });\n        },\n\n        /**\n         * Handle print stop event.\n         *\n         * @param {Event} e\n         * @returns {boolean}\n         */\n        handlePrintStop: function(e) {\n            e.preventDefault();\n            t.pageContainer.css('margin-top', t.pageHeaderHeight);\n            if (Y.UA.gecko) {\n                t.pageContainer.css('padding-top', 0);\n                t.pageHeader.css('top', -Math.abs(t.pageHeaderHeight));\n            }\n            t.handlePrintForOrdering(false);\n            return true;\n        },\n\n        /**\n         * Handle print for Ordering question type.\n         *\n         * @param {boolean} isPrinting\n         */\n        handlePrintForOrdering: function(isPrinting) {\n            var sortablesVertical = $(t.SELECTOR.QTYPE_ORDERING_VERTICAL_SORTABLE_LIST);\n            var sortablesHorizontal = $(t.SELECTOR.QTYPE_ORDERING_HORIZONTAL_SORTABLE_LIST);\n            if (sortablesVertical.length || sortablesHorizontal.length) {\n                if (isPrinting) {\n                    sortablesVertical.each(function(i, nodeSortableVertical) {\n                        // We already removed all the margin and padding in the CSS.\n                        // So we need to add extra spacing here.\n                        var marginEle = $(t.TEMPLATE.QTYPE_ORDERING_MARGIN);\n                        $(nodeSortableVertical).before(marginEle);\n                        $(nodeSortableVertical).after(marginEle);\n                    });\n\n                    sortablesHorizontal.each(function(i, nodeSortableHorizontal) {\n                        // Horizontal ordering is different with vertical.\n                        // So we need to wrap the sortable with a wrapper and add extra spacing later.\n                        var marginEle = $(t.TEMPLATE.QTYPE_ORDERING_MARGIN);\n                        marginEle.addClass('horizontal');\n                        $(nodeSortableHorizontal).after(marginEle);\n                        $(nodeSortableHorizontal).wrap(t.TEMPLATE.QTYPE_ORDERING_WRAPPER);\n                    });\n                } else {\n                    // Remove all the margin placeholder.\n                    $(t.SELECTOR.QTYPE_ORDERING_MARGIN).remove();\n                    if (sortablesHorizontal.length) {\n                        sortablesHorizontal.each(function(i, nodeSortableHorizontal) {\n                            // Remove the wrapper for horizontal sortable.\n                            $(nodeSortableHorizontal).unwrap();\n                        });\n                    }\n                }\n            }\n        }\n\n    };\n\n    return t;\n});\n"],"file":"print.min.js"}